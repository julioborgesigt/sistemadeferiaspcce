<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conclusão do Cadastro</title>
    <link rel="stylesheet" href="calendario.css">

    <script>
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }
    </script>
    <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
    


</head>
<body>
    <div class="container">
        <h2 id="tituloCalendario">Calendário de Férias - Ano Corrente</h2>
        <div id="info">
            <!-- As informações do cadastro serão exibidas aqui -->
        </div>
        
        <div>
            <button id="anoCorrenteBtn">Ano Corrente</button>
            <button id="proximoAnoBtn">Próximo Ano</button>
            <button onclick="window.print()">Imprimir</button>
            <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
        </div>
        <div id="calendarioCorrente" class="calendario-ano"></div>
        <div id="calendarioProximo" class="calendario-ano" style="display:none;"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('banco_dados.json')
                .then(response => response.json())
                .then(database => {
                    criarCalendario(database, new Date().getFullYear(), 'calendarioCorrente');
                    criarCalendario(database, new Date().getFullYear() + 1, 'calendarioProximo');
                })
                .catch(error => {
                    console.error('Erro ao carregar o banco de dados:', error);
                    document.getElementById('info').innerHTML = "<p>Erro ao carregar o banco de dados.</p>";
                });

            document.getElementById('anoCorrenteBtn').addEventListener('click', () => {
                document.getElementById('calendarioCorrente').style.display = 'block';
                document.getElementById('calendarioProximo').style.display = 'none';
                document.getElementById('tituloCalendario').innerText = 'Calendário de Férias - Ano Corrente';
            });

            document.getElementById('proximoAnoBtn').addEventListener('click', () => {
                document.getElementById('calendarioCorrente').style.display = 'none';
                document.getElementById('calendarioProximo').style.display = 'block';
                document.getElementById('tituloCalendario').innerText = 'Calendário de Férias - Próximo Ano';
            });
        });

        function criarCalendario(database, ano, containerId) {
            const container = document.getElementById(containerId);
            const meses = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];

            const cores = ['#FF6347', '#FFD700', '#90EE90', '#1E90FF', '#9370DB', '#FF69B4', '#FFA500', '#00CED1', '#8B4513', '#00FF7F'];
            const corUsuario = {};

            const datasFerias = [];
            let corIndex = 0;
            for (const usuario in database) {
                corUsuario[usuario] = cores[corIndex % cores.length];
                corIndex++;

                const periodos = [
                    { inicio: database[usuario].periodo11, fim: database[usuario].periodo12 },
                    { inicio: database[usuario].periodo21, fim: database[usuario].periodo22 },
                    { inicio: database[usuario].periodo31, fim: database[usuario].periodo32 }
                ];

                periodos.forEach(periodo => {
                    if (periodo.inicio && periodo.fim) {
                        const [inicioDia, inicioMes, inicioAno] = periodo.inicio.split('/');
                        const [fimDia, fimMes, fimAno] = periodo.fim.split('/');
                        const inicio = new Date(`${inicioAno}-${inicioMes}-${inicioDia}`);
                        const fim = new Date(`${fimAno}-${fimMes}-${fimDia}`);

                        for (let d = new Date(inicio); d <= fim; d.setDate(d.getDate() + 1)) {
                            const dataStr = new Date(d).toISOString().split('T')[0];
                            const feriasData = datasFerias.find(f => f.data === dataStr);
                            if (feriasData) {
                                feriasData.usuarios.push(database[usuario].nome);
                            } else {
                                datasFerias.push({ data: dataStr, usuarios: [database[usuario].nome] });
                            }
                        }
                    }
                });
            }

            for (let mes = 0; mes < 12; mes++) {
                const table = document.createElement('table');
                table.classList.add('calendario');
                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                const th = document.createElement('th');
                th.colSpan = 7;
                th.textContent = meses[mes];
                headerRow.appendChild(th);
                thead.appendChild(headerRow);
                table.appendChild(thead);

                const tbody = document.createElement('tbody');
                const diasSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
                const diasHeaderRow = document.createElement('tr');
                diasSemana.forEach(dia => {
                    const diaTh = document.createElement('th');
                    diaTh.textContent = dia;
                    diasHeaderRow.appendChild(diaTh);
                });
                tbody.appendChild(diasHeaderRow);

                const primeiroDia = new Date(ano, mes, 1).getDay();
                const ultimoDia = new Date(ano, mes + 1, 0).getDate();
                let diaAtual = 1;

                for (let semana = 0; semana < 6; semana++) {
                    const row = document.createElement('tr');
                    for (let dia = 0; dia < 7; dia++) {
                        const cell = document.createElement('td');
                        if (semana === 0 && dia < primeiroDia) {
                            cell.textContent = '';
                        } else if (diaAtual > ultimoDia) {
                            cell.textContent = '';
                        } else {
                            const dataStr = `${ano}-${String(mes + 1).padStart(2, '0')}-${String(diaAtual).padStart(2, '0')}`;
                            const feriasData = datasFerias.find(f => f.data === dataStr);
                            cell.textContent = diaAtual;
                            if (feriasData) {
                                cell.style.backgroundColor = corUsuario[feriasData.usuarios[0]];
                                cell.title = feriasData.usuarios.join(', ');
                            }
                            diaAtual++;
                        }
                        row.appendChild(cell);
                    }
                    tbody.appendChild(row);
                }

                table.appendChild(tbody);
                container.appendChild(table);
            }
        }
    </script>
</body>
</html>
